
<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Combinatorial Testing: Writing Behavior Model | TestFlows</title>
  <meta name="description" content="An article about how to write a simple behavior model to verify expected results of combinatorial tests for a memory function.">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="author" content="Vitaliy Zakaznikov">
  <meta name="og:site_name" content="TestFlows">
  <meta property="og:image" content="https://testflows.com/images/combinatorial-tests-writing-behavior-model.png">
  
  <link rel="preload" as="image" href="https://testflows.com/img/logo.png">
  
  
  <meta name="image" property="og:image" content="https://testflows.com/">
<meta name="publish_date" property="og:publish_date" content="2024-10-07T00:00:00-0000">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-10-07T00:00:00-0000" />
<meta property="og:title" content="Combinatorial Testing: Writing Behavior Model">
<meta property="og:image" content="https://testflows.com/">
<meta property="og:description" content="An article about how to write a simple behavior model to verify expected results of combinatorial tests for a memory function.">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Combinatorial Testing: Writing Behavior Model">
<meta name="twitter:description" content="An article about how to write a simple behavior model to verify expected results of combinatorial tests for a memory function.">
<meta name="twitter:image" content="https://testflows.com/">
  
  
  <link href="https://testflows.com/img/favicon.ico" rel="icon">
  
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/bootstrap/bootstrap.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css?v=1741186787140" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/fontawesome/css/all.css?v=1.0" type="text/css">
  <link rel="stylesheet" href="/css/style.css?v=1741186787140" media="screen" type="text/css">
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-sham.min.js"></script>
  <![endif]-->
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.2"></head>

<body>
  <nav id="main-nav" class="fixed-top navbar navbar-expand-md navbar-fixed-top" role="navigation">
    <a class="navbar-brand" href="/">
        <img src="/img/logo-white.png" alt="TestFlows">
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon fas fa-2x fa-bars"></span>
    </button>
    <div class="collapse navbar-collapse nav-menu" id="navbarNav">
        <ul class="nav navbar-nav">
            
                <li class="nav-item">
                    <a class="nav-link" href="/handbook"><i class="fas fa-book pr-2"></i>Handbook</a>
                </li>
            
                <li class="nav-item">
                    <a class="nav-link" href="/blog"><i class="fas fa-blog pr-2"></i>Blog</a>
                </li>
            
                <li class="nav-item">
                    <a class="nav-link" href="/assistant"><i class="fas fa-robot pr-2"></i>Assistant</a>
                </li>
            
                <li class="nav-item">
                    <a class="nav-link" href="/about.html"><i class="fas fa-info-circle pr-2"></i>About</a>
                </li>
            
                <li class="nav-item">
                    <a class="nav-link" href="/contact.html"><i class="fas fa-envelope-open-text pr-2"></i>Contact</a>
                </li>
            
        </ul>
    </div>
</nav>
<div class="clearfix"></div>

  <div class="container-fluid p-0">
    <div class="content">
      <div class="container" style="padding-bottom: 2em !important">
    <div class="post-header row">
        <div class="post-summary col-lg-6 mt-auto mb-auto">
            <h1 style="font-weight: bold;">Combinatorial Testing: Writing Behavior Model</h1>
            <div class="post-metadata">
                <div class="post-author">
                    <span class="author-title text-nowrap">Written By</span><span class="author-name">Vitaliy Zakaznikov</span>
                    <time datetime="2024-10-07T00:00:00-0000"><span class="authored-date text-nowrap">Oct 7, 2024</span></time>
                </div>
                <div class="post-share btn-group" role="group" aria-label="share">
                    <span class="caption">Share It</span>
                    <a target="_blank" rel="noopener external nofollow noreferrer" href="https://twitter.com/intent/tweet?url=https://testflows.com/blog/combinatorial-testing-behavior-model/">
                        <i class="fab fa-2x fa-twitter"></i>
                    </a>
                    <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.facebook.com/sharer/sharer.php?u=https://testflows.com/blog/combinatorial-testing-behavior-model/">
                        <i class="fab fa-2x fa-facebook"></i>
                    </a>
                    <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.linkedin.com/shareArticle?mini=true&url=https://testflows.com/blog/combinatorial-testing-behavior-model/">
                        <i class="fab fa-2x fa-linkedin"></i>
                    </a>
                </div>
            </div>
        </div>
        <div class="post-image col-lg-6 m-auto">
            <img src="/images/combinatorial-tests-writing-behavior-model.png"></img>
            <span class="post-image-credit"></span>
        </div>
    </div>
    <div class="blog post-body row">
        <div class="col-12">
            <p>Combinatorial testing significantly increases the test coverage of software systems, achieving levels of thoroughness that are unattainable with traditional test suites focusing on individual scenarios or limited combinations of user actions. However, combinatorial testing introduces the notorious test oracle problem—how to determine or compute the expected behavior for every possible combination of user actions.</p>
<p>The survey <a target="_blank" rel="noopener external nofollow noreferrer" href="https://ieeexplore.ieee.org/document/6963470">“The Oracle Problem in Software Testing: A Survey”</a> provides an excellent overview of this issue, highlighting that deriving or even knowing the correct outcomes for complex combinations is often not straightforward. A common approach to solve this is by developing a behavior model that can compute expected outcomes for given system behaviors. Yet, many testers have never encountered the oracle problem, as they primarily deal with single combination tests. Fewer still have created or even understand what a behavior model entails.</p>
<p>To demystify behavior models, we will explore the development of such a model for a simple stateful system: a memory function that allows users to write, read, or erase data. We’ll illustrate how to apply combinatorial testing to this function and develop a behavior model from scratch to verify expected results.<span id="more"></span></p>
<h1 id="The-memory-function"><a href="#The-memory-function" class="headerlink" title="The memory function"></a>The memory function</h1><p>To illustrate the approach, we’ll use a memory function as our system under test. This system is straightforward to understand, yet the technique is easily adaptable to more complex, real-world systems.</p>
<img class="img-fluid" src="/images/memory-function-diagram.png" height="500px" style="display:block; margin:auto">

<p>In Python, we’ll define the <code>memory</code> function as follows:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">memory</span>(<span class="params">addr, value=<span class="number">0</span>, mode=<span class="string">&quot;r&quot;</span>, default=<span class="number">0</span>, mem_=&#123;&#125;</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Read or write a value into memory at a given address.</span></span><br><span class="line"><span class="string">    The mode is a combination of flags: &#x27;r&#x27; for read, &#x27;w&#x27; for write,</span></span><br><span class="line"><span class="string">    or &#x27;e&#x27; for erase all. The default mode is &#x27;r&#x27;.&quot;&quot;&quot;</span></span><br><span class="line">    _value = default</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> mode:</span><br><span class="line">        _value = mem_.get(addr, _value)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;e&quot;</span> <span class="keyword">in</span> mode:</span><br><span class="line">        mem_.clear()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;w&quot;</span> <span class="keyword">in</span> mode:</span><br><span class="line">        mem_[addr] = value</span><br><span class="line">    <span class="keyword">return</span> _value</span><br></pre></td></tr></table></figure>

<h1 id="Understanding-the-memory-function"><a href="#Understanding-the-memory-function" class="headerlink" title="Understanding the memory function"></a>Understanding the memory function</h1><p>The <code>memory</code> function allows users to write or read values at specific addresses and erase all memory contents. Memory is managed by the <code>mem_</code> dictionary, which retains its contents between function calls. The <code>default</code> argument defines the value returned when no value has previously been stored at the specified address.</p>
<p>The <code>mode</code> argument controls the operation performed by the <code>memory</code> function and can include any combination of the following flags:</p>
<ul>
<li><code>&#39;r&#39;</code> - Read a value from the specified address.</li>
<li><code>&#39;w&#39;</code> - Write a value to the specified address.</li>
<li><code>&#39;e&#39;</code> - Erase all memory contents.</li>
</ul>
<p>The function only raises exceptions if the <code>addr</code> is a non-hashable value, resulting in a <code>TypeError</code>, since dictionary keys must be hashable.</p>
<p>When multiple mode flags are set (e.g., <code>&#39;rwe&#39;</code>), the operations are performed in a specific order: read first, then erase, and finally write. Since the <code>memory</code> function represents a stateful system, the sequence of user actions affects the results, making the order of actions important.</p>
<p>For example, attempting to read from a memory address before writing to it will return the default value, while writing first allows the correct value to be read later.</p>
<h1 id="Defining-user-actions"><a href="#Defining-user-actions" class="headerlink" title="Defining user actions"></a>Defining user actions</h1><p>Whether or not one uses combinatorial testing techniques, explicitly defining all possible user actions is crucial for effectively testing any system.</p>
<p>What are the possible user actions for the <code>memory</code> function? Here is the complete list:</p>
<ol>
<li>The user can call the <code>memory</code> function with specific arguments.</li>
<li>The user can expect to receive a default value.</li>
<li>The user can expect to receive a stored value.</li>
<li>The user can expect to encounter an error, such as a <code>TypeError</code> exception
when the <code>addr</code> is non-hashable.</li>
</ol>
<p>The last three actions can generally be categorized as “checking the result.” However, the action of “checking the result” is too generic. To thoroughly test the correct behavior of the <code>memory</code> function, each expectation must be explicitly identified.</p>
<p>Note that we have kept the action of calling the <code>memory</code> function generic, rather than breaking it into separate actions based on specific combinations of arguments. This is because we aim to explore as many argument combinations as possible during testing.</p>
<p>Below is the definition of these actions in code, where each action is represented as a test step:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TestStep(<span class="params">Then</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expect_default_value</span>(<span class="params">self, r, exc, default</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Expect default value.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> exc <span class="keyword">is</span> <span class="literal">None</span>, <span class="string">f&quot;unexpected exception: <span class="subst">&#123;exc&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> r == default, <span class="string">f&quot;&#x27;<span class="subst">&#123;r&#125;</span>&#x27; did not match expected default value &#x27;<span class="subst">&#123;default&#125;</span>&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@TestStep(<span class="params">Then</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expect_stored_value</span>(<span class="params">self, r, exc, stored_value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Expect stored value.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> exc <span class="keyword">is</span> <span class="literal">None</span>, <span class="string">f&quot;unexpected exception: <span class="subst">&#123;exc&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> (</span><br><span class="line">        r == stored_value</span><br><span class="line">    ), <span class="string">f&quot;&#x27;<span class="subst">&#123;r&#125;</span>&#x27; did not match expected stored value &#x27;<span class="subst">&#123;stored_value&#125;</span>&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@TestStep(<span class="params">Then</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expect_error</span>(<span class="params">self, r, exc, error</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Expect error.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> r <span class="keyword">is</span> <span class="literal">None</span>, <span class="string">f&quot;unexpected result: <span class="subst">&#123;r&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">str</span>(exc) == <span class="built_in">str</span>(error), <span class="string">f&quot;expected exception &#x27;<span class="subst">&#123;error&#125;</span>&#x27; but got &#x27;<span class="subst">&#123;exc&#125;</span>&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@TestStep(<span class="params">When</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call_memory</span>(<span class="params">self, addr, value, mode, default</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Call memory function.&quot;&quot;&quot;</span></span><br><span class="line">    r = <span class="literal">None</span></span><br><span class="line">    exc = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = memory(addr=addr, value=value, mode=mode, default=default)</span><br><span class="line">    <span class="keyword">except</span> BaseException <span class="keyword">as</span> err:</span><br><span class="line">        exc = err</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        note(</span><br><span class="line">            <span class="string">f&quot;memory(addr=<span class="subst">&#123;addr&#125;</span>,value=<span class="subst">&#123;value&#125;</span>,mode=<span class="subst">&#123;mode&#125;</span>,default=<span class="subst">&#123;default&#125;</span>) = <span class="subst">&#123;r, exc&#125;</span>&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> r, exc</span><br></pre></td></tr></table></figure>

<p>It is important to note that the library of user actions can be built incrementally. This approach is crucial for real-world systems, where the complete list of user actions may not be clear at the project’s outset. However, it is also important to recognize that failing to identify possible user actions will inevitably result in gaps in test coverage.</p>
<h1 id="Writing-a-combinatorial-test"><a href="#Writing-a-combinatorial-test" class="headerlink" title="Writing a combinatorial test"></a>Writing a combinatorial test</h1><p>With the user action steps defined, we could write a number of simple tests to start verifying different functionalities. However, how many tests do we really need? Many testers don’t even consider this question, and after writing ten, twenty, or perhaps hundred tests, they often assume that is sufficient.</p>
<p>To determine how many tests are truly needed, we first have to calculate the number of ways a user can call the <code>memory</code> function. Next, we need to consider the length of the sequence of calls that users can make and determine the minimum sequence length before we start seeing repeated behaviors in the system.</p>
<p>To calculate the number of ways a user can call the <code>memory</code> function, we need to identify all possible values for each argument that the <code>memory</code> function accepts and multiply these possibilities together.</p>
<p>Specifically, we need to know all possible values for:</p>
<ul>
<li><code>addr</code></li>
<li><code>value</code></li>
<li><code>mode</code></li>
<li><code>default</code></li>
</ul>
<p>The number of possible valid values for the <code>addr</code>, <code>value</code>, and <code>default</code> arguments is effectively unlimited from a practical perspective because:</p>
<ul>
<li><code>addr</code> can be any hashable object.</li>
<li><code>value</code> can be any object.</li>
<li><code>default</code> can be any object.</li>
</ul>
<p>On the other hand, the number of possible valid values for the <code>mode</code> argument can be calculated as follows:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> testflows.combinatorics <span class="keyword">import</span> combinations</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_modes</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Return all possible valid combinations of modes.&quot;&quot;&quot;</span></span><br><span class="line">    flags = [<span class="string">&quot;r&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="string">&quot;e&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        modes = <span class="built_in">list</span>(combinations(flags, i))</span><br><span class="line">        <span class="keyword">for</span> combination <span class="keyword">in</span> modes:</span><br><span class="line">            <span class="keyword">yield</span> <span class="string">&quot;&quot;</span>.join(combination)</span><br></pre></td></tr></table></figure>

<p>This results in the following list of possible <code>mode</code> values:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;rw&#x27;</span>, <span class="string">&#x27;re&#x27;</span>, <span class="string">&#x27;we&#x27;</span>, <span class="string">&#x27;rwe&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>This list is derived from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mn>3</mn><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mi>C</mi><mo stretchy="false">(</mo><mn>3</mn><mo separator="true">,</mo><mn>2</mn><mo stretchy="false">)</mo><mo>+</mo><mi>C</mi><mo stretchy="false">(</mo><mn>3</mn><mo separator="true">,</mo><mn>3</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(3,1) + C(3,2) + C(3,3)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">3</span><span class="mclose">)</span></span></span></span>, where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>n</mi><mo separator="true">,</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(n, k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">)</span></span></span></span> represents the number of ways to choose <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> unordered elements from <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> elements. In our case, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> is <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span>, corresponding to the valid flags (<code>r</code>, <code>w</code>, <code>e</code>), and we are choosing up to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span> elements.</p>
<p>The <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo stretchy="false">(</mo><mi>n</mi><mo separator="true">,</mo><mi>k</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">C(n, k)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.07153em;">C</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mclose">)</span></span></span></span> calculation can be done using the <code>combinations</code> function from Python’s <code>itertools</code> standard module, or alternatively, you can import it from the <code>testflows.combinatorics</code> module for convenience.</p>
<p>The number of possible valid values for the <code>mode</code> argument is <code>7</code>, resulting in the following possible values for each argument:</p>
<ul>
<li><code>addr</code>: Any hashable object.</li>
<li><code>value</code>: Any object.</li>
<li><code>mode</code>: One of <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>7</mn></mrow><annotation encoding="application/x-tex">7</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">7</span></span></span></span> possible values (<code>&#39;r&#39;</code>, <code>&#39;w&#39;</code>, <code>&#39;e&#39;</code>, <code>&#39;rw&#39;</code>, <code>&#39;re&#39;</code>, <code>&#39;we&#39;</code>, <code>&#39;rwe&#39;</code>).</li>
<li><code>default</code>: Any object.</li>
</ul>
<p>There are also numerous invalid <code>mode</code> values or values that are partially valid, such as the string <code>&#39;write me a letter&#39;</code>, which would be treated as <code>&#39;rwe&#39;</code> due to containing all the valid flags. However, for simplicity, we will focus only on the valid values.</p>
<h1 id="Handling-infinite-combinations-with-representative-values"><a href="#Handling-infinite-combinations-with-representative-values" class="headerlink" title="Handling infinite combinations with representative values"></a>Handling infinite combinations with representative values</h1><p>How do we handle the fact that the number of ways a user can call the <code>memory</code> function is practically unlimited? The solution is to select “representative” valid values.</p>
<p>A “representative” value can be informally defined as a value that will produce the same behavior as other values sharing the same characteristics. For example, we can use the number <code>1000</code> as a representative value for <code>addr</code>, assuming that other integers used as <code>addr</code> will behave similarly. Furthermore, since <code>1000</code> is hashable, we can assume that other hashable objects will behave the same way.</p>
<p>A formal definition connects the concept of a “representative” value to equivalence classes as follows:</p>
<blockquote>
<p>A representative value is an element <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> within a set <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span></span></span></span> that belongs to an equivalence class <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>v</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[v]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">]</span></span></span></span> under a defined equivalence relation <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo></mrow><annotation encoding="application/x-tex">\sim</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.3669em;"></span><span class="mrel">∼</span></span></span></span>, such that for any other element <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mo>∈</mo><mo stretchy="false">[</mo><mi>v</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">w \in [v]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">]</span></span></span></span>, the behavior of a function <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span> or system when applied to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>v</mi></mrow><annotation encoding="application/x-tex">v</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span></span></span></span> is equivalent to its behavior when applied to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi></mrow><annotation encoding="application/x-tex">w</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span></span></span></span>. This means <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo stretchy="false">(</mo><mi>v</mi><mo stretchy="false">)</mo><mo>≡</mo><mi>f</mi><mo stretchy="false">(</mo><mi>w</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">f(v) \equiv f(w)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mclose">)</span></span></span></span> for all <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>w</mi><mo>∈</mo><mo stretchy="false">[</mo><mi>v</mi><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">w \in [v]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mclose">]</span></span></span></span>, where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≡</mo></mrow><annotation encoding="application/x-tex">\equiv</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4637em;"></span><span class="mrel">≡</span></span></span></span> denotes behavioral equivalence.</p>
</blockquote>
<p>Of course, these assumptions may or may not hold true. We could even test these assumptions by keeping all other arguments fixed while iterating over different values for a given argument assumed to belong to the same representation class. However, the number of representation classes depends on the number of potential failure modes, which we might not know in advance. Therefore, choosing the “right” representative values is not trivial, but we can start with some reasonable choices.</p>
<p>For example, we can select the following values:</p>
<ul>
<li><code>addr</code>: Either <code>1000</code> or <code>2000</code>.</li>
<li><code>value</code>: Either <code>&#39;hello&#39;</code> or <code>&#39;hello2&#39;</code>.</li>
<li><code>mode</code>: Any of the 7 valid modes (<code>&#39;r&#39;</code>, <code>&#39;w&#39;</code>, <code>&#39;e&#39;</code>, <code>&#39;rw&#39;</code>, <code>&#39;re&#39;</code>, <code>&#39;we&#39;</code>, <code>&#39;rwe&#39;</code>).</li>
<li><code>default</code>: Either <code>0</code> or <code>None</code>.</li>
</ul>
<p>Using these representative values, we can write a combinatorial test to explore all possible ways to execute the <code>memory</code> function. Additionally, we will go further and check all possible sequences of such calls, up to a specified <code>number_of_calls</code>.</p>
<h1 id="Sketching-the-test"><a href="#Sketching-the-test" class="headerlink" title="Sketching the test"></a>Sketching the test</h1><p>Sketching such combinatorial tests using <span><img alt="TestFlows.com Open-Source Testing Framework" style="display: inline; vertical-align: bottom; height: 2em;" src="/img/logo.png"></span> is straightforward. We can use the <a href="https://testflows.com/handbook/#Sketch">TestSketch</a> decorator along with the <a href="https://testflows.com/handbook/#Using-either">either()</a> function as shown below:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TestSketch</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_memory</span>(<span class="params">self, number_of_calls</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Check sequence of memory calls.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> Given(<span class="string">&quot;memory is erased&quot;</span>):</span><br><span class="line">        memory(addr=<span class="number">0</span>, value=<span class="number">0</span>, mode=<span class="string">&quot;e&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> Then(<span class="string">f&quot;check sequence of <span class="subst">&#123;number_of_calls&#125;</span> memory calls&quot;</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(number_of_calls):</span><br><span class="line">            addr = either(*[<span class="number">1000</span>, <span class="number">2000</span>], i=<span class="string">f&quot;addr-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            value = either(*[<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;hello2&quot;</span>], i=<span class="string">f&quot;value-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            mode = either(*[mode <span class="keyword">for</span> mode <span class="keyword">in</span> valid_modes()], i=<span class="string">f&quot;mode-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            default = either(*[<span class="number">0</span>, <span class="literal">None</span>], i=<span class="string">f&quot;default-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            r, exc = call_memory(addr=addr, value=value, mode=mode, default=default)</span><br></pre></td></tr></table></figure>

<p>The test code above checks up to <code>number_of_calls</code> sequential memory calls, covering all possible ways to call the memory function each time. In this case, there are <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>∗</mo><mn>2</mn><mo>∗</mo><mn>7</mn><mo>∗</mo><mn>2</mn><mo>=</mo><mn>56</mn></mrow><annotation encoding="application/x-tex">2 * 2 * 7 * 2 = 56</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">7</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">56</span></span></span></span> possible ways to call the memory function based on our chosen values.</p>
<h1 id="First-test-program"><a href="#First-test-program" class="headerlink" title="First test program"></a>First test program</h1><p>Below is the first version of the test program that we can execute:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> testflows.core <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> testflows.combinatorics <span class="keyword">import</span> combinations, product</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># The memory function</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">memory</span>(<span class="params">addr, value=<span class="number">0</span>, mode=<span class="string">&quot;r&quot;</span>, default=<span class="number">0</span>, mem_=&#123;&#125;</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Read or write a value into memory at a given address.</span></span><br><span class="line"><span class="string">    The mode is combination of flags, where &#x27;r&#x27;, for read, or &#x27;w&#x27;, for write,</span></span><br><span class="line"><span class="string">    or &#x27;e&#x27; for erase all, the default is &#x27;r&#x27;.&quot;&quot;&quot;</span></span><br><span class="line">    _value = default</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> mode:</span><br><span class="line">        _value = mem_.get(addr, _value)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;e&quot;</span> <span class="keyword">in</span> mode:</span><br><span class="line">        mem_.clear()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;w&quot;</span> <span class="keyword">in</span> mode:</span><br><span class="line">        mem_[addr] = value</span><br><span class="line">    <span class="keyword">return</span> _value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Calculating all possible valid combinations of modes.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_modes</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Return all possible valid combinations of modes.&quot;&quot;&quot;</span></span><br><span class="line">    flags = [<span class="string">&quot;r&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="string">&quot;e&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        modes = <span class="built_in">list</span>(combinations(flags, i))</span><br><span class="line">        <span class="keyword">for</span> combination <span class="keyword">in</span> modes:</span><br><span class="line">            <span class="keyword">yield</span> <span class="string">&quot;&quot;</span>.join(combination)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Test steps for user actions</span></span><br><span class="line"><span class="meta">@TestStep(<span class="params">Then</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expect_default_value</span>(<span class="params">self, r, exc, default</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Expect default value.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> exc <span class="keyword">is</span> <span class="literal">None</span>, <span class="string">f&quot;unexpected exception: <span class="subst">&#123;exc&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> r == default, <span class="string">f&quot;&#x27;<span class="subst">&#123;r&#125;</span>&#x27; did not match expected default value &#x27;<span class="subst">&#123;default&#125;</span>&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@TestStep(<span class="params">Then</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expect_stored_value</span>(<span class="params">self, r, exc, stored_value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Expect stored value.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> exc <span class="keyword">is</span> <span class="literal">None</span>, <span class="string">f&quot;unexpected exception: <span class="subst">&#123;exc&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> (</span><br><span class="line">        r == stored_value</span><br><span class="line">    ), <span class="string">f&quot;&#x27;<span class="subst">&#123;r&#125;</span>&#x27; did not match expected stored value &#x27;<span class="subst">&#123;stored_value&#125;</span>&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@TestStep(<span class="params">Given</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expect_error</span>(<span class="params">self, r, exc, error</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Expect error.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> r <span class="keyword">is</span> <span class="literal">None</span>, <span class="string">f&quot;unexpected result: <span class="subst">&#123;r&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">str</span>(exc) == <span class="built_in">str</span>(error), <span class="string">f&quot;expected exception &#x27;<span class="subst">&#123;error&#125;</span>&#x27; but got &#x27;<span class="subst">&#123;exc&#125;</span>&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@TestStep(<span class="params">When</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call_memory</span>(<span class="params">self, addr, value, mode, default</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Call memory function.&quot;&quot;&quot;</span></span><br><span class="line">    r = <span class="literal">None</span></span><br><span class="line">    exc = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = memory(addr=addr, value=value, mode=mode, default=default)</span><br><span class="line">    <span class="keyword">except</span> BaseException <span class="keyword">as</span> err:</span><br><span class="line">        exc = err</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        note(</span><br><span class="line">            <span class="string">f&quot;memory(addr=<span class="subst">&#123;addr&#125;</span>,value=<span class="subst">&#123;value&#125;</span>,mode=<span class="subst">&#123;mode&#125;</span>,default=<span class="subst">&#123;default&#125;</span>) = <span class="subst">&#123;r, exc&#125;</span>&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> r, exc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Combinatorial sketch</span></span><br><span class="line"><span class="meta">@TestSketch</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_memory</span>(<span class="params">self, number_of_calls</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Check sequence of all possible valid combinations of memory calls.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> Given(<span class="string">&quot;memory is erased&quot;</span>):</span><br><span class="line">        memory(addr=<span class="number">0</span>, value=<span class="number">0</span>, mode=<span class="string">&quot;e&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> Then(<span class="string">f&quot;check sequence of <span class="subst">&#123;number_of_calls&#125;</span> memory calls&quot;</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(number_of_calls):</span><br><span class="line">            addr = either(*[<span class="number">1000</span>, <span class="number">2000</span>], i=<span class="string">f&quot;addr-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            value = either(*[<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;hello2&quot;</span>], i=<span class="string">f&quot;value-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            mode = either(*[mode <span class="keyword">for</span> mode <span class="keyword">in</span> valid_modes()], i=<span class="string">f&quot;mode-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            default = either(*[<span class="number">0</span>, <span class="literal">None</span>], i=<span class="string">f&quot;default-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            r, exc = call_memory(addr=addr, value=value, mode=mode, default=default)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Test feature</span></span><br><span class="line"><span class="meta">@TestFeature</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">feature</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Check memory function.&quot;&quot;&quot;</span></span><br><span class="line">    check_memory(number_of_calls=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> main():</span><br><span class="line">    feature()</span><br></pre></td></tr></table></figure>

<h1 id="First-test-program-output"><a href="#First-test-program-output" class="headerlink" title="First test program output"></a>First test program output</h1><p>When executed, this test program produces the following output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Passing</span><br><span class="line"></span><br><span class="line">✔ [ OK ] <span class="string">&#x27;/feature/check memory&#x27;</span> (46ms)</span><br><span class="line">✔ [ OK ] <span class="string">&#x27;/feature&#x27;</span> (49ms)</span><br><span class="line"></span><br><span class="line">1 feature (1 ok)</span><br><span class="line">1 sketch (1 ok)</span><br><span class="line">56 combinations (56 ok)</span><br><span class="line">112 steps (112 ok)</span><br><span class="line"></span><br><span class="line">Total time 49ms</span><br></pre></td></tr></table></figure>

<p>The output indicates that all <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>56</mn></mrow><annotation encoding="application/x-tex">56</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">56</span></span></span></span> combinations were successfully executed without any failures.</p>
<p>The detailed test log for the first combination is below:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Oct 07,2024 13:30:11       ⟥  Combination pattern #0</span><br><span class="line">                                Check sequence of all possible valid combinations of memory calls.</span><br><span class="line">Oct 07,2024 13:30:11         ⟥  Given memory is erased, flags:MANDATORY|SETUP</span><br><span class="line">               258us         ⟥⟤ OK memory is erased, /feature/check memory/pattern #0/memory is erased</span><br><span class="line">Oct 07,2024 13:30:11         ⟥  Then check sequence of 1 memory calls</span><br><span class="line">               203us         ⟥    [note] memory(addr=1000,value=hello,mode=r,default=0) = (0, None)</span><br><span class="line">               251us         ⟥⟤ OK check sequence of 1 memory calls, /feature/check memory/pattern #0/check sequence of 1 memory calls</span><br><span class="line">               880us       ⟥⟤ OK pattern #0, /feature/check memory/pattern #0</span><br></pre></td></tr></table></figure>

<p>In this output:</p>
<ul>
<li>Combination pattern #0 represents the first of the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>56</mn></mrow><annotation encoding="application/x-tex">56</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">56</span></span></span></span> test combinations.</li>
<li>The test starts by erasing the memory to ensure a clean state before proceeding.</li>
<li>It then executes the memory call <code>memory(addr=1000, value=hello, mode=r, default=0)</code> and confirms the result is <code>(0, None)</code>— meaning the default value of 0 is returned, and no exception occurs.</li>
</ul>
<p>The full log illustrates how each combination is executed in sequence, and provides a clear view of the memory operations and their outcomes. By exploring all <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>56</mn></mrow><annotation encoding="application/x-tex">56</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">56</span></span></span></span> combinations, we ensure comprehensive coverage of different input scenarios for the memory function using our selected representative values.</p>
<h1 id="Increasing-number-of-calls"><a href="#Increasing-number-of-calls" class="headerlink" title="Increasing number of calls"></a>Increasing number of calls</h1><p>To demonstrate how easy it is to extend our test program, we can increase the number of memory function calls to <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn></mrow><annotation encoding="application/x-tex">2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">2</span></span></span></span> by modifying the feature that calls the <code>check_memory</code> combinatorial sketch and passing <code>number_of_calls=2</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TestFeature</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">feature</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Check memory function.&quot;&quot;&quot;</span></span><br><span class="line">    check_memory(number_of_calls=<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>By executing this modified test program, we will observe that it now results in <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3136</mn></mrow><annotation encoding="application/x-tex">3136</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3136</span></span></span></span> combinations being covered! This is calculated as <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>56</mn></mrow><annotation encoding="application/x-tex">56</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">56</span></span></span></span> combinations for the first memory call multiplied by <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>56</mn></mrow><annotation encoding="application/x-tex">56</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">56</span></span></span></span> combinations for the second memory call, giving us a total of:</p>
<blockquote>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>56</mn><mo>×</mo><mn>56</mn><mo>=</mo><mn>3136</mn></mrow><annotation encoding="application/x-tex">56 \times 56 = 3136</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">56</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">56</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3136</span></span></span></span> combinations
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Passing</span><br><span class="line"></span><br><span class="line">✔ [ OK ] <span class="string">&#x27;/feature/check memory&#x27;</span> (4s 214ms)</span><br><span class="line">✔ [ OK ] <span class="string">&#x27;/feature&#x27;</span> (4s 217ms)</span><br><span class="line"></span><br><span class="line">1 feature (1 ok)</span><br><span class="line">1 sketch (1 ok)</span><br><span class="line">3136 combinations (3136 ok)</span><br><span class="line">6272 steps (6272 ok)</span><br><span class="line"></span><br><span class="line">Total time 4s 217ms</span><br></pre></td></tr></table></figure>

<p>This output demonstrates that increasing the number of sequential memory calls results in an exponential increase in the number of combinations covered, ensuring even more comprehensive test coverage. In this case, the test program executed <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3136</mn></mrow><annotation encoding="application/x-tex">3136</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3136</span></span></span></span> different combinations giving us greater confidence in the correctness of the memory function for longer sequences of calls.</p>
<h1 id="Determining-the-minimum-number-of-calls"><a href="#Determining-the-minimum-number-of-calls" class="headerlink" title="Determining the minimum number of calls"></a>Determining the minimum number of calls</h1><p>We have seen how easily we can adjust the length of the sequence of memory function calls. Now, it would be beneficial to determine the minimum number of calls needed to ensure comprehensive coverage of all possible system states.</p>
<p>To simplify our analysis, let’s consider a simplified model of the <code>memory</code> function with the following assumptions:</p>
<ol>
<li>All addresses are considered identical (indistinct).</li>
<li>The specific values stored are irrelevant.</li>
<li>Overwriting previously stored values is significant.</li>
</ol>
<p>With these assumptions, we can represent the system in terms of <strong>abstract states</strong>—broad states that summarize the underlying conditions of the system. The simplified system can exist in only three distinct abstract states:</p>
<ol>
<li><strong>State 0 (Uninitialized)</strong>: No write operations have been performed.</li>
<li><strong>State 1 (Initialized without Overwrites)</strong>: At least one write operation has been performed to an uninitialized address, but no overwrites have occurred.</li>
<li><strong>State 2 (Initialized with Overwrites)</strong>: At least one overwrite operation has occurred (i.e., writing to an address that has already been written to).</li>
</ol>
<p>Mathematically, we represent the set of possible system abstract states as:</p>
<blockquote>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mo stretchy="false">{</mo><msub><mi>s</mi><mn>0</mn></msub><mo separator="true">,</mo><msub><mi>s</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>s</mi><mn>2</mn></msub><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">S = \{ s_0, s_1, s_2 \} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6833em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">{</span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">}</span></span></span></span>
</blockquote>
<p>where each <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">s_i </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span> corresponds to one of the abstract states above.</p>
<p>By applying the <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Pigeonhole_principle">Pigeonhole Principle</a>—which states that if <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> items are placed into <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span> containers, and <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mi>k</mi></mrow><annotation encoding="application/x-tex">n &gt; k </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span></span></span></span>, then at least one container must contain more than one item—we conclude that after <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">n = 3 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span> operations (the number of unique abstract states <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">∣</mi><mi>S</mi><mi mathvariant="normal">∣</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">|S| = 3 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span>), any subsequent operation (<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>&gt;</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">n &gt; 3 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5782em;vertical-align:-0.0391em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span>) must result in an abstract state that has already occurred, causing a repetition. Formally, since <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mtext>operations</mtext></msub><mo>&gt;</mo><mi mathvariant="normal">∣</mi><mi>S</mi><mi mathvariant="normal">∣</mi></mrow><annotation encoding="application/x-tex">n_{\text{operations}} &gt; |S| </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8252em;vertical-align:-0.2861em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3175em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">operations</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">∣</span></span></span></span>, an abstract state must repeat.</p>
<p>Thus, the minimum number of operations before the system abstract state repeats is:</p>
<blockquote>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>n</mi><mtext>min</mtext></msub><mo>=</mo><mi mathvariant="normal">∣</mi><mi>S</mi><mi mathvariant="normal">∣</mi><mo>=</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">n_{\text{min}} = |S| = 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3175em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">min</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord">∣</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span>
</blockquote>
<p>This understanding is crucial for effective testing and allows us to ensure that all possible combinations of representative values are tested using the fewest necessary operations. By ensuring that the number of operations <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>≥</mo><msub><mi>n</mi><mtext>min</mtext></msub></mrow><annotation encoding="application/x-tex">n \geq n_{\text{min}} </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719em;vertical-align:-0.136em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.5806em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3175em;"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">min</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>, we guarantee comprehensive coverage of all system abstract states, facilitating thorough verification and validation of the <code>memory</code> function’s behavior.</p>
<p>The analysis shows that we need to set <em>number_of_calls</em> to <code>3</code>
and the total number of combinations using our chosen values is:</p>
<blockquote>
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>56</mn><mo>∗</mo><mn>56</mn><mo>∗</mo><mn>56</mn><mo>=</mo><mn>175616</mn></mrow><annotation encoding="application/x-tex">56 * 56 * 56 = 175616 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">56</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">56</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">56</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">175616</span></span></span></span>
</blockquote>
<h1 id="Introducing-the-behavior-model"><a href="#Introducing-the-behavior-model" class="headerlink" title="Introducing the behavior model"></a>Introducing the behavior model</h1><p>So far, our combinatorial test sketch was actually a dummy and did not check the returned value and exception after calling the <code>call_memory</code> action. To fix that, we need to write a behavior model that can calculate the expected result and exception for any possible combination of memory calls.</p>
<p>Conceptually, the behavior model needs to implement only the <code>expect</code> method, which takes the current behavior (i.e., the current sequence of states) and returns a function that takes the current result and exception and asserts if they are correct. The model’s <code>expect</code> method should just contain an <strong>or</strong> expression that will select the expected user action with predefined values (using partial functions).</p>
<p>To implement the behavior model, we need to define two key classes: <code>State</code> and <code>Model</code>.</p>
<h2 id="The-State-class"><a href="#The-State-class" class="headerlink" title="The State class"></a>The <code>State</code> class</h2><p>The <code>State</code> class must represent the state of the system at a given point in time and
is defined as follows:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, addr, value, mode, default, error=<span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.addr = addr</span><br><span class="line">        self.value = value</span><br><span class="line">        self.mode = mode</span><br><span class="line">        self.default = default</span><br><span class="line">        self.error = error</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;State(addr=<span class="subst">&#123;self.addr&#125;</span>,value=<span class="subst">&#123;self.value&#125;</span>,mode=<span class="subst">&#123;self.mode&#125;</span>,default=<span class="subst">&#123;self.default&#125;</span>,error=<span class="subst">&#123;self.error&#125;</span>)&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Each <code>State</code> object captures the relevant parameters of a memory operation, including the address (<code>addr</code>), value (<code>value</code>), mode (<code>mode</code>), default value (<code>default</code>), and any error (<code>error</code>). These state objects are used to represent the sequence of operations that have been performed, forming the current system <strong>behavior</strong>.</p>
<p>Notably, the state does not include the output value directly, as it is computed by the model. It captures all input variables (<code>addr</code>, <code>value</code>, <code>mode</code>, <code>default</code>) and one output variable (<code>error</code>). While the <code>error</code> variable could be excluded to maintain purity and focus solely on inputs, including it simplifies the model’s logic. It allows easier computation of the expected result in the <code>expect_stored_value</code> method, which will be implemented in the model’s class. Therefore, it’s part of the state representation.</p>
<p>For more complex systems, the <code>State</code> class could include all input and output variables. However, extra care must be taken when computing the expected result of the system’s behavior to avoid improperly using the actual output in the calculation, as this could mask potential errors. Therefore, when practical, restricting the <code>State</code> attributes to only inputs acts as a safeguard against such mistakes, ensuring the integrity of the behavior model.</p>
<h2 id="The-Model-class"><a href="#The-Model-class" class="headerlink" title="The Model class"></a>The <code>Model</code> class</h2><p>The <code>Model</code> class implements the behavior model of the memory function. Its primary responsibility is to determine the expected outcome of each memory operation based on the sequence of states, which defines the system’s behavior. The class includes methods that analyze this behavior to predict the correct outcome in the current state, which is always the last state in the sequence.</p>
<ul>
<li><p><strong><code>expect_error</code> Method</strong>: This is method checks if an error is expected based on the current state. For example, if the address is not hashable (e.g., a list), this method will predict that an error should be raised.</p>
</li>
<li><p><strong><code>expect_default_value</code> Method</strong>: This method returns the default value if no write operation has modified the value at the specified address. It helps determine the expected output when a read operation is performed on an uninitialized memory address.</p>
</li>
<li><p><strong><code>expect_stored_value</code> Method</strong>: This method checks if a previously stored value should be returned. It considers the impact of previous write operations and whether there have been any erase operations that would have cleared the memory.</p>
</li>
<li><p><strong><code>expect</code> Method</strong>: This is the <strong>main method</strong> of the model which calculates the correct expectation by invoking one of the above methods, based on the current behavior. It uses an <code>or</code> expression to select the first valid expected outcome.</p>
</li>
</ul>
<p>The <code>Model</code> class is defined as follows:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Model</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Behavior model of the memory function.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">expect_error</span>(<span class="params">self, behavior</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Expect error.&quot;&quot;&quot;</span></span><br><span class="line">        current_state = behavior[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="string">&quot;w&quot;</span> <span class="keyword">in</span> current_state.mode <span class="keyword">or</span> <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> current_state.mode):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">hash</span>(current_state.addr)</span><br><span class="line">        <span class="keyword">except</span> BaseException <span class="keyword">as</span> err:</span><br><span class="line">            <span class="keyword">return</span> partial(expect_error, error=err)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">expect_default_value</span>(<span class="params">self, behavior</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Expect default value.&quot;&quot;&quot;</span></span><br><span class="line">        current_state = behavior[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> partial(expect_default_value, default=current_state.default)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">expect_stored_value</span>(<span class="params">self, behavior</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Expect stored value.&quot;&quot;&quot;</span></span><br><span class="line">        current_state = behavior[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        default_value = current_state.default</span><br><span class="line">        stored_value = default_value</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> current_state.mode:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> state <span class="keyword">in</span> behavior[:-<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;e&quot;</span> <span class="keyword">in</span> state.mode <span class="keyword">and</span> <span class="keyword">not</span> (</span><br><span class="line">                <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> state.mode <span class="keyword">and</span> state.error <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">            ):</span><br><span class="line">                stored_value = default_value</span><br><span class="line">            <span class="keyword">if</span> (</span><br><span class="line">                <span class="string">&quot;w&quot;</span> <span class="keyword">in</span> state.mode</span><br><span class="line">                <span class="keyword">and</span> state.addr == current_state.addr</span><br><span class="line">                <span class="keyword">and</span> state.error <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line">            ):</span><br><span class="line">                stored_value = state.value</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> stored_value != default_value:</span><br><span class="line">            <span class="keyword">return</span> partial(expect_stored_value, stored_value=stored_value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">expect</span>(<span class="params">self, behavior</span>):</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            self.expect_error(behavior)</span><br><span class="line">            <span class="keyword">or</span> self.expect_stored_value(behavior)</span><br><span class="line">            <span class="keyword">or</span> self.expect_default_value(behavior)</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>

<h2 id="The-expect-method"><a href="#The-expect-method" class="headerlink" title="The expect method"></a>The <code>expect</code> method</h2><p>The <code>expect_error</code> is the main method and the order of methods in the <code>or</code> expression defined within this method is important:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">expect</span>(<span class="params">self, behavior</span>):</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        self.expect_error(behavior)</span><br><span class="line">        <span class="keyword">or</span> self.expect_stored_value(behavior)</span><br><span class="line">        <span class="keyword">or</span> self.expect_default_value(behavior)</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<ol>
<li><code>expect_error</code>: The model first checks if an error should be expected for the current state, such as when an address is unhashable.</li>
<li><code>expect_stored_value</code>: If no error is expected, the model then checks if a stored value should be returned based on prior operations.</li>
<li><code>expect_default_value</code>: If no error or stored value applies, the model defaults to expecting the predefined default value.</li>
</ol>
<p>The <strong>or</strong> expression ensures that the first applicable outcome is returned, which makes the model efficient and deterministic.</p>
<p>Note that there is a clear distinction between the model’s expect methods and the user actions that take place during testing:</p>
<p>The model’s <code>expect_*</code> methods predict what should happen based on the sequence of operations. The corresponding user actions (test steps) are then used to verify that the actual behavior of the memory function matches the predicted behavior.
For example, the model’s <code>expect_stored_value</code> method returns a partial <code>expect_stored_value</code> user action, which will be called later in the <code>check_result</code> action to assert that the observed behavior matches the expected behavior.</p>
<p>It’s important to note that the expect method is built iteratively as you model the system’s actual behavior and check if it aligns with the desired behavior. For instance, the first version of the expect method could be as simple as the following, where we initially expect only the default value to be returned for any behavior:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># the first incorrect version</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expect</span>(<span class="params">self, behavior</span>):</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        self.expect_default_value(behavior)</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<p>This initial implementation is obviously incorrect but serves as a stepping stone in the model’s development. Running tests will reveal failing combinations where this expectation is invalid. If all combinations pass, it indicates a mistake in the test code, as we expect some combinations to return a stored value and others to return the default value.</p>
<h2 id="The-expect-default-value-method"><a href="#The-expect-default-value-method" class="headerlink" title="The expect_default_value method"></a>The <code>expect_default_value</code> method</h2><p>Since the <code>expect_default_value</code> method is called last in the <code>expect</code> method, it is the simplest to implement. This is because it serves as the default expectation. It becomes the default because it is the final part of the <code>or</code> expression, meaning that if no other expectations are met, the model will return its result as the default expectation.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">expect_default_value</span>(<span class="params">self, behavior</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Expect default value.&quot;&quot;&quot;</span></span><br><span class="line">    current_state = behavior[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> partial(expect_default_value, default=current_state.default)</span><br></pre></td></tr></table></figure>

<p>The method just needs to retrieve the current state, which is the last element in the <code>behavior</code> list, and return a partial <code>expect_default_value</code> action where the <code>default</code> value is set to the <code>current_state.default</code> value — where <code>current_state.default</code> is the <code>default</code> value passed by the user in the last memory function call.</p>
<h2 id="The-expect-error-method"><a href="#The-expect-error-method" class="headerlink" title="The expect_error method"></a>The <code>expect_error</code> method</h2><p>The next method in terms of complexity is the <code>expect_error</code> method. This method implements
the behavior where we expect an error only if the <code>addr</code> value is unhashable.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">expect_error</span>(<span class="params">self, behavior</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Expect error.&quot;&quot;&quot;</span></span><br><span class="line">    current_state = behavior[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (<span class="string">&quot;w&quot;</span> <span class="keyword">in</span> current_state.mode <span class="keyword">or</span> <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> current_state.mode):</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">hash</span>(current_state.addr)</span><br><span class="line">    <span class="keyword">except</span> BaseException <span class="keyword">as</span> err:</span><br><span class="line">        <span class="keyword">return</span> partial(expect_error, error=err)</span><br></pre></td></tr></table></figure>

<p>To determine if an error should be expected, we only need to examine the current state, which is the last element in the <code>behavior</code> list. This list stores the sequence of states that fully describes the system’s behavior at this point.</p>
<p>We know that an error should only be returned if we are trying to write or read, which means checking for the presence of the <code>w</code> or <code>r</code> flags in the <code>mode</code> attribute of the current state. If neither flag is present, the method should just return, which effectively means returning <code>None</code>. This results in a <code>False</code> value in a boolean context, allowing the <code>or</code> expression inside the expect method to check the next expectation.</p>
<p>We then check if the <code>addr</code> value is hashable by attempting to get a hash using the <code>hash</code> function. If an exception is raised, we return a partial <code>expect_error</code> action with the <code>error</code> argument set to the raised exception.</p>
<h1 id="The-expect-stored-value-method"><a href="#The-expect-stored-value-method" class="headerlink" title="The expect_stored_value method"></a>The <code>expect_stored_value</code> method</h1><p>The most complex expectation method is <code>expect_stored_value</code>. This method computes the expected value stored at the given <code>addr</code>, accounting for operations such as uninitialized values, memory erasure, and overwrites. To achieve this, it iterates through all states except the current one in the behavior sequence.</p>
<p>A more efficient implementation could start from the state immediately before the current one and move backward, which would be optimal for longer sequences. However, since the behavior list is expected to be short, we prioritize intuitive logic over premature optimization.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">expect_stored_value</span>(<span class="params">self, behavior</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Expect stored value.&quot;&quot;&quot;</span></span><br><span class="line">    current_state = behavior[-<span class="number">1</span>]</span><br><span class="line">    default_value = current_state.default</span><br><span class="line">    stored_value = default_value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> current_state.mode:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> state <span class="keyword">in</span> behavior[:-<span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;e&quot;</span> <span class="keyword">in</span> state.mode <span class="keyword">and</span> <span class="keyword">not</span> (</span><br><span class="line">            <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> state.mode <span class="keyword">and</span> state.error <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">        ):</span><br><span class="line">            stored_value = default_value</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            <span class="string">&quot;w&quot;</span> <span class="keyword">in</span> state.mode</span><br><span class="line">            <span class="keyword">and</span> state.addr == current_state.addr</span><br><span class="line">            <span class="keyword">and</span> state.error <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line">        ):</span><br><span class="line">            stored_value = state.value</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> stored_value != default_value:</span><br><span class="line">        <span class="keyword">return</span> partial(expect_stored_value, stored_value=stored_value)</span><br></pre></td></tr></table></figure>

<p>The current state, default value, and expected stored value are set, where the default stored value is simply the default value for the current state. This logic is managed by the initial lines:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">current_state = behavior[-<span class="number">1</span>]</span><br><span class="line">default_value = current_state.default</span><br><span class="line">stored_value = default_value</span><br></pre></td></tr></table></figure>

<p>Next, we short-circuit and return <code>None</code> if we are not reading the memory in the current state. There’s no need to compute a stored value if no read operation is occurring:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> current_state.mode:</span><br><span class="line">    <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<p>If we are reading, we loop through each state in the behavior, except for the current state, to determine what the stored value should be:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> state <span class="keyword">in</span> behavior[:-<span class="number">1</span>]:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;e&quot;</span> <span class="keyword">in</span> state.mode <span class="keyword">and</span> <span class="keyword">not</span> (</span><br><span class="line">        <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> state.mode <span class="keyword">and</span> state.error <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">    ):</span><br><span class="line">        stored_value = default_value</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        <span class="string">&quot;w&quot;</span> <span class="keyword">in</span> state.mode</span><br><span class="line">        <span class="keyword">and</span> state.addr == current_state.addr</span><br><span class="line">        <span class="keyword">and</span> state.error <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line">    ):</span><br><span class="line">        stored_value = state.value</span><br></pre></td></tr></table></figure>

<p>Inside the loop, we handle two cases: when memory is erased and when a new value is written to the address.</p>
<p>Memory Erasure: If the e flag is set and no error occurs during a read operation, the memory is considered erased, and we set the stored value to the default value. This ensures that failed reads (with both r and e flags) don’t overwrite memory erasure.</p>
<p>Memory Write: If a write (w) occurs at the same address without error, we set the stored value to the value written in that state. If both r and w flags are set, reading is prioritized, and we check for a failing read via the error attribute.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> stored_value != default_value:</span><br><span class="line">    <span class="keyword">return</span> partial(expect_stored_value, stored_value=stored_value)</span><br></pre></td></tr></table></figure>

<p>Finally, after iterating through the previous states, if the stored value differs from the default, we return a partial <code>expect_stored_value</code> action with the computed stored value. Otherwise, we return <code>None</code> and let the <code>expect</code> method proceed to check the next expectation.</p>
<h1 id="Using-the-model-in-the-test"><a href="#Using-the-model-in-the-test" class="headerlink" title="Using the model in the test"></a>Using the model in the test</h1><p>Here is the modified version of the test that now uses the behavior model defined above. This version integrates the behavior model to automatically determine the expected results of each memory operation:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TestSketch</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_memory</span>(<span class="params">self, number_of_calls</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Check sequence of all possible valid combinations of memory calls.&quot;&quot;&quot;</span></span><br><span class="line">    model = Model() <span class="comment"># behavior model</span></span><br><span class="line">    behavior = [] <span class="comment"># sequence of states</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> Given(<span class="string">&quot;memory is erased&quot;</span>):</span><br><span class="line">        memory(addr=<span class="number">0</span>, value=<span class="number">0</span>, mode=<span class="string">&quot;e&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> Then(<span class="string">f&quot;check sequence of <span class="subst">&#123;number_of_calls&#125;</span> memory calls&quot;</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(number_of_calls):</span><br><span class="line">            addr = either(*[<span class="number">1000</span>, <span class="number">2000</span>], i=<span class="string">f&quot;addr-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            value = either(*[<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;hello2&quot;</span>], i=<span class="string">f&quot;value-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            mode = either(*[mode <span class="keyword">for</span> mode <span class="keyword">in</span> valid_modes()], i=<span class="string">f&quot;mode-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            default = either(*[<span class="number">0</span>, <span class="literal">None</span>], i=<span class="string">f&quot;default-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># add the state to the current behavior</span></span><br><span class="line">            behavior.append(State(addr, value, mode, default))</span><br><span class="line">            r, exc = call_memory(addr=addr, value=value, mode=mode, default=default)</span><br><span class="line">            <span class="comment"># set current state&#x27;s error, if any, to simplify model calculations</span></span><br><span class="line">            behavior[-<span class="number">1</span>].error = exc</span><br><span class="line">            <span class="comment"># check result against the model for the current behavior</span></span><br><span class="line">            check_result(r=r, exc=exc, behavior=behavior, model=model)</span><br></pre></td></tr></table></figure>

<p>The <code>check_result</code> function is defined as a test step to validate the result of the memory function call. It takes several parameters:</p>
<ul>
<li><code>r</code>: The result of the memory operation.</li>
<li><code>exc</code>: The exception that was raised during the memory operation, if any.</li>
<li><code>behavior</code>: A list that stores the sequence of states representing the history of operations.</li>
<li><code>model</code>: The behavior model used to determine the expected outcome.</li>
</ul>
<p>The function uses the behavior model to get the <code>expect</code> function, which will then be called to assert if the result (<code>r</code>) and the exception (<code>exc</code>) are correct.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TestStep(<span class="params">Then</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_result</span>(<span class="params">self, r, exc, behavior, model</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Check result of the memory call.&quot;&quot;&quot;</span></span><br><span class="line">    expect = model.expect(behavior)</span><br><span class="line">    debug(<span class="string">f&quot;expect=<span class="subst">&#123;expect.__name__&#125;</span>, r=<span class="subst">&#123;r&#125;</span>, exc=<span class="subst">&#123;exc&#125;</span>&quot;</span>)</span><br><span class="line">    expect(r=r, exc=exc)</span><br></pre></td></tr></table></figure>

<h1 id="Complete-test-program"><a href="#Complete-test-program" class="headerlink" title="Complete test program"></a>Complete test program</h1><p>Below is the complete test program that uses the behavior model, which we can execute to validate the behavior of the <code>memory</code> function, checking if the results match the expected behavior for any given sequence of operations:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> testflows.core <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> testflows.combinatorics <span class="keyword">import</span> combinations, product</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># The memory function</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">memory</span>(<span class="params">addr, value=<span class="number">0</span>, mode=<span class="string">&quot;r&quot;</span>, default=<span class="number">0</span>, mem_=&#123;&#125;</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Read or write a value into memory at a given address.</span></span><br><span class="line"><span class="string">    The mode is combination of flags, where &#x27;r&#x27;, for read, or &#x27;w&#x27;, for write,</span></span><br><span class="line"><span class="string">    or &#x27;e&#x27; for erase all, the default is &#x27;r&#x27;.&quot;&quot;&quot;</span></span><br><span class="line">    _value = default</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> mode:</span><br><span class="line">        _value = mem_.get(addr, _value)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;e&quot;</span> <span class="keyword">in</span> mode:</span><br><span class="line">        mem_.clear()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;w&quot;</span> <span class="keyword">in</span> mode:</span><br><span class="line">        mem_[addr] = value</span><br><span class="line">    <span class="keyword">return</span> _value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Calculating all possible valid combinations of modes.</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">valid_modes</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Return all possible valid combinations of modes.&quot;&quot;&quot;</span></span><br><span class="line">    flags = [<span class="string">&quot;r&quot;</span>, <span class="string">&quot;w&quot;</span>, <span class="string">&quot;e&quot;</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">4</span>):</span><br><span class="line">        modes = <span class="built_in">list</span>(combinations(flags, i))</span><br><span class="line">        <span class="keyword">for</span> combination <span class="keyword">in</span> modes:</span><br><span class="line">            <span class="keyword">yield</span> <span class="string">&quot;&quot;</span>.join(combination)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Test steps for user actions</span></span><br><span class="line"><span class="meta">@TestStep(<span class="params">Then</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expect_default_value</span>(<span class="params">self, r, exc, default</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Expect default value.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> exc <span class="keyword">is</span> <span class="literal">None</span>, <span class="string">f&quot;unexpected exception: <span class="subst">&#123;exc&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> r == default, <span class="string">f&quot;&#x27;<span class="subst">&#123;r&#125;</span>&#x27; did not match expected default value &#x27;<span class="subst">&#123;default&#125;</span>&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@TestStep(<span class="params">Then</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expect_stored_value</span>(<span class="params">self, r, exc, stored_value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Expect stored value.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> exc <span class="keyword">is</span> <span class="literal">None</span>, <span class="string">f&quot;unexpected exception: <span class="subst">&#123;exc&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> (</span><br><span class="line">        r == stored_value</span><br><span class="line">    ), <span class="string">f&quot;&#x27;<span class="subst">&#123;r&#125;</span>&#x27; did not match expected stored value &#x27;<span class="subst">&#123;stored_value&#125;</span>&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@TestStep(<span class="params">Given</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expect_error</span>(<span class="params">self, r, exc, error</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Expect error.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> r <span class="keyword">is</span> <span class="literal">None</span>, <span class="string">f&quot;unexpected result: <span class="subst">&#123;r&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">str</span>(exc) == <span class="built_in">str</span>(error), <span class="string">f&quot;expected exception &#x27;<span class="subst">&#123;error&#125;</span>&#x27; but got &#x27;<span class="subst">&#123;exc&#125;</span>&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@TestStep(<span class="params">When</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">call_memory</span>(<span class="params">self, addr, value, mode, default</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Call memory function.&quot;&quot;&quot;</span></span><br><span class="line">    r = <span class="literal">None</span></span><br><span class="line">    exc = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r = memory(addr=addr, value=value, mode=mode, default=default)</span><br><span class="line">    <span class="keyword">except</span> BaseException <span class="keyword">as</span> err:</span><br><span class="line">        exc = err</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        note(</span><br><span class="line">            <span class="string">f&quot;memory(addr=<span class="subst">&#123;addr&#125;</span>,value=<span class="subst">&#123;value&#125;</span>,mode=<span class="subst">&#123;mode&#125;</span>,default=<span class="subst">&#123;default&#125;</span>) = <span class="subst">&#123;r, exc&#125;</span>&quot;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">return</span> r, exc</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@TestStep(<span class="params">Then</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_result</span>(<span class="params">self, r, exc, behavior, model</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Check result of the memory call.&quot;&quot;&quot;</span></span><br><span class="line">    expect = model.expect(behavior)</span><br><span class="line">    debug(<span class="string">f&quot;expect=<span class="subst">&#123;expect.__name__&#125;</span>, r=<span class="subst">&#123;r&#125;</span>, exc=<span class="subst">&#123;exc&#125;</span>&quot;</span>)</span><br><span class="line">    expect(r=r, exc=exc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># State class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">State</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, addr, value, mode, default, error=<span class="literal">None</span></span>) -&gt; <span class="literal">None</span>:</span><br><span class="line">        self.addr = addr</span><br><span class="line">        self.value = value</span><br><span class="line">        self.mode = mode</span><br><span class="line">        self.default = default</span><br><span class="line">        self.error = error</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__str__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;State(addr=<span class="subst">&#123;self.addr&#125;</span>,value=<span class="subst">&#123;self.value&#125;</span>,mode=<span class="subst">&#123;self.mode&#125;</span>,default=<span class="subst">&#123;self.default&#125;</span>,error=<span class="subst">&#123;self.error&#125;</span>)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Model class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Model</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Behavior model of the memory function.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">expect_error</span>(<span class="params">self, behavior</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Expect error.&quot;&quot;&quot;</span></span><br><span class="line">        current_state = behavior[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="string">&quot;w&quot;</span> <span class="keyword">in</span> current_state.mode <span class="keyword">or</span> <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> current_state.mode):</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">hash</span>(current_state.addr)</span><br><span class="line">        <span class="keyword">except</span> BaseException <span class="keyword">as</span> err:</span><br><span class="line">            <span class="keyword">return</span> partial(expect_error, error=err)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">expect_default_value</span>(<span class="params">self, behavior</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Expect default value.&quot;&quot;&quot;</span></span><br><span class="line">        current_state = behavior[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> partial(expect_default_value, default=current_state.default)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">expect_stored_value</span>(<span class="params">self, behavior</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Expect stored value.&quot;&quot;&quot;</span></span><br><span class="line">        current_state = behavior[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">        default_value = current_state.default</span><br><span class="line">        stored_value = default_value</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> current_state.mode:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> state <span class="keyword">in</span> behavior[:-<span class="number">1</span>]:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;e&quot;</span> <span class="keyword">in</span> state.mode <span class="keyword">and</span> <span class="keyword">not</span> (</span><br><span class="line">                <span class="string">&quot;r&quot;</span> <span class="keyword">in</span> state.mode <span class="keyword">and</span> state.error <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">            ):</span><br><span class="line">                stored_value = default_value</span><br><span class="line">            <span class="keyword">if</span> (</span><br><span class="line">                <span class="string">&quot;w&quot;</span> <span class="keyword">in</span> state.mode</span><br><span class="line">                <span class="keyword">and</span> state.addr == current_state.addr</span><br><span class="line">                <span class="keyword">and</span> state.error <span class="keyword">is</span> <span class="literal">None</span></span><br><span class="line">            ):</span><br><span class="line">                stored_value = state.value</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> stored_value != default_value:</span><br><span class="line">            <span class="keyword">return</span> partial(expect_stored_value, stored_value=stored_value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">expect</span>(<span class="params">self, behavior</span>):</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            self.expect_error(behavior)</span><br><span class="line">            <span class="keyword">or</span> self.expect_stored_value(behavior)</span><br><span class="line">            <span class="keyword">or</span> self.expect_default_value(behavior)</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Combinatorial sketch that uses the behavior model</span></span><br><span class="line"><span class="meta">@TestSketch</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_memory</span>(<span class="params">self, number_of_calls=<span class="number">3</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Check sequence of all possible valid combinations of memory calls.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    model = Model()</span><br><span class="line">    behavior = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> Given(<span class="string">&quot;memory is erased&quot;</span>):</span><br><span class="line">        memory(addr=<span class="number">0</span>, value=<span class="number">0</span>, mode=<span class="string">&quot;e&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> Then(<span class="string">f&quot;check sequence of <span class="subst">&#123;number_of_calls&#125;</span> memory calls&quot;</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(number_of_calls):</span><br><span class="line">            addr = either(*[<span class="number">1000</span>, <span class="number">2000</span>], i=<span class="string">f&quot;addr-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            value = either(*[<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;hello2&quot;</span>], i=<span class="string">f&quot;value-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            mode = either(*[mode <span class="keyword">for</span> mode <span class="keyword">in</span> valid_modes()], i=<span class="string">f&quot;mode-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            default = either(*[<span class="number">0</span>, <span class="literal">None</span>], i=<span class="string">f&quot;default-<span class="subst">&#123;i&#125;</span>&quot;</span>)</span><br><span class="line">            behavior.append(State(addr, value, mode, default))</span><br><span class="line">            r, exc = call_memory(addr=addr, value=value, mode=mode, default=default)</span><br><span class="line">            behavior[-<span class="number">1</span>].error = exc</span><br><span class="line">            check_result(r=r, exc=exc, behavior=behavior, model=model)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@TestFeature</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">feature</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Check memory function.&quot;&quot;&quot;</span></span><br><span class="line">    check_memory(number_of_calls=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> main():</span><br><span class="line">    feature()</span><br></pre></td></tr></table></figure>

<h1 id="Complete-test-program-output"><a href="#Complete-test-program-output" class="headerlink" title="Complete test program output"></a>Complete test program output</h1><p>When executed, the complete test program produces the following output:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Passing</span><br><span class="line"></span><br><span class="line">✔ [ OK ] <span class="string">&#x27;/feature/check memory&#x27;</span> (5m 4s)</span><br><span class="line">✔ [ OK ] <span class="string">&#x27;/feature&#x27;</span> (5m 4s)</span><br><span class="line"></span><br><span class="line">1 feature (1 ok)</span><br><span class="line">1 sketch (1 ok)</span><br><span class="line">175616 combinations (175616 ok)</span><br><span class="line">351232 steps (351232 ok)</span><br><span class="line"></span><br><span class="line">Total time 5m 4s</span><br></pre></td></tr></table></figure>

<p>This output shows that we executed <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>56</mn><mo>×</mo><mn>56</mn><mo>×</mo><mn>56</mn><mo>=</mo><mn>175616</mn></mrow><annotation encoding="application/x-tex">56 \times 56 \times 56 = 175616 </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">56</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.7278em;vertical-align:-0.0833em;"></span><span class="mord">56</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">56</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">175616</span></span></span></span> combinations, covering all possible ways to execute a sequence of 3 memory function calls. Each combination is verified against the expected behavior as defined by the behavior model.</p>
<p>As an example, the detailed test log for the <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>189</mn><mi>t</mi><mi>h</mi></mrow><annotation encoding="application/x-tex">189th</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6944em;"></span><span class="mord">189</span><span class="mord mathnormal">t</span><span class="mord mathnormal">h</span></span></span></span> combination is shown below:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Oct 07,2024 17:30:44       ⟥  Combination pattern <span class="comment">#189</span></span><br><span class="line">                                Check sequence of all possible valid combinations of memory calls.</span><br><span class="line">                                Arguments</span><br><span class="line">                                  number_of_calls</span><br><span class="line">                                    3</span><br><span class="line">Oct 07,2024 17:30:44         ⟥  Given memory is erased, flags:MANDATORY|SETUP</span><br><span class="line">               170us         ⟥⟤ OK memory is erased, /feature/check memory/pattern <span class="comment">#189/memory is erased</span></span><br><span class="line">Oct 07,2024 17:30:44         ⟥  Then check sequence of 3 memory calls</span><br><span class="line">               185us         ⟥    [note] memory(addr=1000,value=hello,mode=r,default=0) = (0, None)</span><br><span class="line">               223us         ⟥    [debug] expect=expect_default_value, r=0, exc=None</span><br><span class="line">               268us         ⟥    [note] memory(addr=1000,value=hello,mode=w,default=None) = (None, None)</span><br><span class="line">               298us         ⟥    [debug] expect=expect_default_value, r=None, exc=None</span><br><span class="line">               339us         ⟥    [note] memory(addr=1000,value=hello2,mode=rw,default=None) = (<span class="string">&#x27;hello&#x27;</span>, None)</span><br><span class="line">               366us         ⟥    [debug] expect=expect_stored_value, r=hello, exc=None</span><br><span class="line">               412us         ⟥⟤ OK check sequence of 3 memory calls, /feature/check memory/pattern <span class="comment">#189/check sequence of 3 memory calls</span></span><br><span class="line">               937us       ⟥⟤ OK pattern <span class="comment">#189, /feature/check memory/pattern #189</span></span><br><span class="line">Oct 07,2024 17:30:44       ⟥  Combination pattern <span class="comment">#190</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>The log shows that we called the memory function <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>3</mn></mrow><annotation encoding="application/x-tex">3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">3</span></span></span></span> times as specified by the <code>number_of_calls</code> argument:</p>
<ol>
<li>First Memory Call:</li>
</ol>
<ul>
<li>The call attempts to read from the memory (<code>mode=r</code>).</li>
<li>Since no previous value has been written to the specified address (<code>addr=1000</code>), the default value (<code>0</code>) is returned.</li>
<li>The behavior model correctly computed the expected outcome as <code>expect_default_value</code>.</li>
</ul>
<ol start="2">
<li>Second Memory Call:</li>
</ol>
<ul>
<li>The call writes the value <code>&quot;hello&quot;</code> to the memory at address <code>1000</code> (<code>mode=w</code>).</li>
<li>The expected outcome was to write successfully without an exception, resulting in (None, None).</li>
<li>The behavior model correctly computed <code>expect_default_value</code> since it was a write operation without a read.</li>
</ul>
<ol start="3">
<li>Third Memory Call:</li>
</ol>
<ul>
<li>The call reads from and writes to memory in one operation (<code>mode=rw</code>). The value <code>&quot;hello2&quot;</code> is written, but it also reads from the memory address.</li>
<li>The previously stored value <code>&quot;hello&quot;</code> (written during the second call) is returned.</li>
<li>The behavior model correctly computed the outcome as <code>expect_stored_value</code>, indicating that the value stored earlier should be returned.</li>
</ul>
<p>The log messages show debug information that provides insight into the behavior model’s expectations for each call. Entries such as <code>[debug] expect=expect_default_value, r=0, exc=None</code> indicate the expected outcome calculated by the model (<code>expect_default_value</code>) and confirm that the actual result (<code>r=0</code>) and exception (<code>exc=None</code>) match the expected result.</p>
<p>The output confirms that the behavior model accurately predicted the expected results for all <code>3</code> memory operations in this combination. The model’s predictions align perfectly with the actual outcomes, as evidenced by the <code>OK</code> status for each test step.</p>
<p>By executing <code>175616</code> combinations, we thoroughly validated the memory function across a wide range of input sequences, ensuring that all possible behaviors are correctly handled. This approach provides comprehensive coverage and confidence in the correctness of the implementation.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>Combinatorial testing is a powerful method for exhaustively verifying the behavior of systems. By building a behavior model, we addressed the “oracle problem”—the challenge of determining correct outcomes for every possible combination of inputs. By focusing on representative values and abstract states, we were able to reduce the number of combinations and limit the maximum length of memory function calls, while still ensuring comprehensive coverage of the system’s behavior.</p>
<p>The behavior model, designed to compute the correct outcomes for a sequence of operations, was invaluable for testing a stateful system like the memory function. It allowed us to verify the correct behavior for <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>175</mn><mo separator="true">,</mo><mn>616</mn></mrow><annotation encoding="application/x-tex">175,616</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8389em;vertical-align:-0.1944em;"></span><span class="mord">175</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord">616</span></span></span></span> combinations of three consecutive memory function calls. Although demonstrated with a simple system, this approach is scalable and adaptable to far more complex, real-world scenarios.</p>
<p>Ultimately, the combination of combinatorial testing and behavior models provides an efficient and systematic way to verify stateful systems, offering a level of test coverage and thoroughness that surpasses and can’t be achieved using traditional methods.</p>

        </div>
        <div class="col-12 divider"></div>
        <div class="post-footer"></div>

        <!-- Read Next Carousel Section -->
        
            <div id="readNextCarousel" class="carousel slide col-12" data-ride="carousel" data-interval="5000">
                <div class="carousel-inner">
                    
                        <div class="carousel-item active">
                            <div class="row">
                                
                                <div class="col-md-6 d-flex">
                                    <a href="/blog/what-do-condition-proposition-predicate-property-and-invariant-really-mean/" class="card shadow-sm d-flex flex-column text-decoration-none text-dark">
                                        <img src="/images/what-do-condition-proposition-predicate-property-invariant-really-mean.png" class="card-img-top" alt="What Do Condition, Proposition, Predicate, Property, and Invariant Really Mean?">
                                        <div class="card-body d-flex flex-column">
                                            <h3 class="card-title">What Do Condition, Proposition, Predicate, Property, and Invariant Really Mean?</h3>
                                            <p class="card-text flex-grow-1">
                                                In software testing, you often hear terms like “condition,” “proposition,” “predicate,” “property,” ...
                                            </p>
                                        </div>
                                    </a>                                     
                                </div>
                                
                                <div class="col-md-6 d-flex">
                                    <a href="/blog/transforming-testing-behavior-models-into-formal-models/" class="card shadow-sm d-flex flex-column text-decoration-none text-dark">
                                        <img src="/images/transforming-testing-behavior-models-into-formal-models.png" class="card-img-top" alt="Transforming Testing Behavior Models into Formal Models">
                                        <div class="card-body d-flex flex-column">
                                            <h3 class="card-title">Transforming Testing Behavior Models into Formal Models</h3>
                                            <p class="card-text flex-grow-1">
                                                Most software systems do not come with formal models. However, formal models are invaluable for cons...
                                            </p>
                                        </div>
                                    </a>                                     
                                </div>
                                
                            </div>
                        </div>
                    
                        <div class="carousel-item ">
                            <div class="row">
                                
                                <div class="col-md-6 d-flex">
                                    <a href="/blog/testing-simple-train-control-system-using-formal-description/" class="card shadow-sm d-flex flex-column text-decoration-none text-dark">
                                        <img src="/images/testing-simple-train-control-system-using-formal-description.png" class="card-img-top" alt="Testing Simple Train Control System Using Its Formal Description">
                                        <div class="card-body d-flex flex-column">
                                            <h3 class="card-title">Testing Simple Train Control System Using Its Formal Description</h3>
                                            <p class="card-text flex-grow-1">
                                                In our previous post, Decoding Formal Description of a Simple Train Control System, we examined how ...
                                            </p>
                                        </div>
                                    </a>                                     
                                </div>
                                
                                <div class="col-md-6 d-flex">
                                    <a href="/blog/decoding-formal-description-simple-train-control-system/" class="card shadow-sm d-flex flex-column text-decoration-none text-dark">
                                        <img src="/images/decoding-formal-description-simple-train-control-system.png" class="card-img-top" alt="Decoding Formal Description of a Simple Train Control System">
                                        <div class="card-body d-flex flex-column">
                                            <h3 class="card-title">Decoding Formal Description of a Simple Train Control System</h3>
                                            <p class="card-text flex-grow-1">
                                                In scientific research on software testing, you often come across papers filled with complex mathema...
                                            </p>
                                        </div>
                                    </a>                                     
                                </div>
                                
                            </div>
                        </div>
                    
                        <div class="carousel-item ">
                            <div class="row">
                                
                                <div class="col-md-6 d-flex">
                                    <a href="/blog/using-atomic-propositions-and-equivalence-classes-part1/" class="card shadow-sm d-flex flex-column text-decoration-none text-dark">
                                        <img src="/images/using-atomic-propositions-and-equivalence-classes-part1.png" class="card-img-top" alt="Using Atomic Propositions and Equivalence Classes (Part 1)">
                                        <div class="card-body d-flex flex-column">
                                            <h3 class="card-title">Using Atomic Propositions and Equivalence Classes (Part 1)</h3>
                                            <p class="card-text flex-grow-1">
                                                Atomic propositions and equivalence classes offer a practical solution for making testing manageable...
                                            </p>
                                        </div>
                                    </a>                                     
                                </div>
                                
                                <div class="col-md-6 d-flex">
                                    <a href="/blog/using-atomic-propositions-and-equivalence-classes-part2/" class="card shadow-sm d-flex flex-column text-decoration-none text-dark">
                                        <img src="/images/using-atomic-propositions-and-equivalence-classes-part2.png" class="card-img-top" alt="Using Atomic Propositions and Equivalence Classes (Part 2)">
                                        <div class="card-body d-flex flex-column">
                                            <h3 class="card-title">Using Atomic Propositions and Equivalence Classes (Part 2)</h3>
                                            <p class="card-text flex-grow-1">
                                                Building on the foundations from Part 1 🛸, where we introduced atomic propositions and equivalence ...
                                            </p>
                                        </div>
                                    </a>                                     
                                </div>
                                
                            </div>
                        </div>
                    
                        <div class="carousel-item ">
                            <div class="row">
                                
                                <div class="col-md-6 d-flex">
                                    <a href="/blog/sketching-combinations-for-combinatorial-tests/" class="card shadow-sm d-flex flex-column text-decoration-none text-dark">
                                        <img src="/images/sketching-combinations.png" class="card-img-top" alt="Sketching Combinations For Combinatorial Tests">
                                        <div class="card-body d-flex flex-column">
                                            <h3 class="card-title">Sketching Combinations For Combinatorial Tests</h3>
                                            <p class="card-text flex-grow-1">
                                                Writing combinatorial tests usually requires that the author of the test plans for combinatorial tes...
                                            </p>
                                        </div>
                                    </a>                                     
                                </div>
                                
                                <div class="col-md-6 d-flex">
                                    <a href="/blog/combinatorial-testing-the-introduction/" class="card shadow-sm d-flex flex-column text-decoration-none text-dark">
                                        <img src="/images/combinatorial-tests-intro.png" class="card-img-top" alt="Combinatorial Testing: The Introduction">
                                        <div class="card-body d-flex flex-column">
                                            <h3 class="card-title">Combinatorial Testing: The Introduction</h3>
                                            <p class="card-text flex-grow-1">
                                                According to the US National Institute of Standards and Technology’s (NIST) page on Combinatorial Te...
                                            </p>
                                        </div>
                                    </a>                                     
                                </div>
                                
                            </div>
                        </div>
                    
                        <div class="carousel-item ">
                            <div class="row">
                                
                                <div class="col-md-6 d-flex">
                                    <a href="/blog/bdd-or-not-to-bdd-or-maybe-tdd-or-even-atdd/" class="card shadow-sm d-flex flex-column text-decoration-none text-dark">
                                        <img src="/images/bdd-or-not-to-bdd.png" class="card-img-top" alt="BDD or not to BDD, or TDD, or even ATDD. How does it affect your QA team?">
                                        <div class="card-body d-flex flex-column">
                                            <h3 class="card-title">BDD or not to BDD, or TDD, or even ATDD. How does it affect your QA team?</h3>
                                            <p class="card-text flex-grow-1">
                                                How do software development processes such as behavior-driven development (BDD), test-driven develop...
                                            </p>
                                        </div>
                                    </a>                                     
                                </div>
                                
                                <div class="col-md-6 d-flex">
                                    <a href="/blog/get-your-software-covered-using-covering-arrays/" class="card shadow-sm d-flex flex-column text-decoration-none text-dark">
                                        <img src="/images/covering-arrays.png" class="card-img-top" alt="Get Your Software Covered Using Covering Arrays">
                                        <div class="card-body d-flex flex-column">
                                            <h3 class="card-title">Get Your Software Covered Using Covering Arrays</h3>
                                            <p class="card-text flex-grow-1">
                                                For software systems with any non-trivial number of parameters, exhaustively testing all possible co...
                                            </p>
                                        </div>
                                    </a>                                     
                                </div>
                                
                            </div>
                        </div>
                    
                        <div class="carousel-item ">
                            <div class="row">
                                
                                <div class="col-md-6 d-flex">
                                    <a href="/blog/working-with-requirements-just-like-with-code/" class="card shadow-sm d-flex flex-column text-decoration-none text-dark">
                                        <img src="/images/requirements-as-code.png" class="card-img-top" alt="Working With Requirements Just Like With Code">
                                        <div class="card-body d-flex flex-column">
                                            <h3 class="card-title">Working With Requirements Just Like With Code</h3>
                                            <p class="card-text flex-grow-1">
                                                “Requirements are the starting point of any design”, this is a quote from the presentation given by ...
                                            </p>
                                        </div>
                                    </a>                                     
                                </div>
                                
                                <div class="col-md-6 d-flex">
                                    <a href="/blog/how-to-break-your-tests-into-steps/" class="card shadow-sm d-flex flex-column text-decoration-none text-dark">
                                        <img src="/images/test-steps.png" class="card-img-top" alt="Making Your Tests Better or How to Break Your Tests Into Steps">
                                        <div class="card-body d-flex flex-column">
                                            <h3 class="card-title">Making Your Tests Better or How to Break Your Tests Into Steps</h3>
                                            <p class="card-text flex-grow-1">
                                                Writing tests is not as easy task as it may seem at first glance.
In many cases, writing a good test...
                                            </p>
                                        </div>
                                    </a>                                     
                                </div>
                                
                            </div>
                        </div>
                    
                </div>
                <!-- Carousel Controls -->
                <a class="carousel-control-prev" href="#readNextCarousel" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#readNextCarousel" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>
        
        <!-- End of Read Next Carousel -->
    </div>
</div>
<script>
    window.addEventListener("load", function(){
        // add support to make headers to be clickable
        document.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(function(element){
            element.addEventListener("click", function(event){
                element_id = element.getAttribute("id");
                if (element_id) {
                    window.location = "#" + element_id;
                }
            }, true);
        });
    });

    document.addEventListener("DOMContentLoaded", function () {
        var carousel = document.getElementById("readNextCarousel");
        var touchStartX = 0;
        var touchEndX = 0;

        function handleSwipe() {
            if (touchEndX < touchStartX - 50) {
                // Swipe left → Move to next slide
                var nextBtn = document.querySelector("#readNextCarousel .carousel-control-next");
                if (nextBtn) nextBtn.click();
            } else if (touchEndX > touchStartX + 50) {
                // Swipe right → Move to previous slide
                var prevBtn = document.querySelector("#readNextCarousel .carousel-control-prev");
                if (prevBtn) prevBtn.click();
            }
        }

        carousel.addEventListener("touchstart", function (event) {
            touchStartX = event.changedTouches[0].screenX;
        });

        carousel.addEventListener("touchend", function (event) {
            touchEndX = event.changedTouches[0].screenX;
            handleSwipe();
        });
    });
</script>

    </div>
  </div>
  <div class="container-footer" id="container-footer">
    
    <footer> <div class="row no-gutters">
    <div class="col-12 text-center">
        <div class="links">
            <div class="btn-group" role="group" aria-label="Basic example">
                <button type="button" class="btn btn-secondary">
                    <a target="_blank" rel="noopener external nofollow noreferrer" href="https://pypi.org/project/testflows/">
                        <span class="fab fa-2x fa-python"></span>
                    </a>
                </button>
                <button type="button" class="btn btn-secondary">
                    <a target="_blank" rel="noopener external nofollow noreferrer" href="https://t.me/testflows">
                        <span class="fab fa-2x fa-telegram-plane"></span>
                    </a>
                </button>
                <button type="button" class="btn btn-secondary">
                    <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/testflows">
                        <span class="fab fa-2x fa-github"></span>
                    </a>
                </button>
            </div>
        </div>
    </div>
    <div class="col-12 text-center">
        <img src="/img/favicon-square.png"</img>
    </div>
    <div class="col-12 text-center">
        Copyright 2020-2022 Katteli Inc.
    </div>
    <div class="col-12 text-center">
        <span class="text-nowrap">All rights reserved.</span>
    </div>
    <div class="col-12 text-center no-padding links">
        <a class="btn" href="/credits.html">Credits</a>
    </div>
</div>
 </footer>
    
  </div>
  <script src="/js/jquery-3.4.1.slim.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap/bootstrap.min.js"></script>
<script src="https://unpkg.com/3d-force-graph@1.72.3/dist/3d-force-graph.min.js"></script>
<script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "ab95920418b1480e9f8458e94fe40615"}'></script>
<script>
var isInViewport = function (elem) {
    var bounding = elem.getBoundingClientRect();
    return (
        bounding.top >= 0 &&
        bounding.left >= 0 &&
        bounding.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
        bounding.right <= (window.innerWidth || document.documentElement.clientWidth)
    );
};
var banner = document.querySelector('.banner');
window.addEventListener('scroll', function (event) {
	if (isInViewport(banner)) {
    	banner.classList.remove("not-in-view");
	} else {
	    banner.classList.add("not-in-view");
	}
}, false);
// codeblock copy
function codeblock_copy() {
    $("figure.highlight").hover(
        function() {
            var figure = $(this);
            $( this ).append($("<button class=\"btn codeblock-copy\"><i class=\"fas fa-clipboard\"></i></button>"));
        }, function() {
            $( this ).find("button").first().remove();
        }
    );
    $("figure.highlight").click(
        function() {
            var figure = $(this);
            navigator.clipboard.writeText(figure.find(".code").first()[0].innerText.trimEnd()).then(
                function() {
                    figure.find(".codeblock-copy").find("i").removeClass("fa-clipboard").addClass("fa-clipboard-check");
                }
            )
        }
    );
}
// apply codeblock copy
codeblock_copy()
// hero graph
function heroGraph() {
    const distance = 2350;
    const N = 7;
    const msb = n => Math.max(0, 31 - Math.clz32(n));
    const gData = {
        nodes: [...Array(2**(N+1)-2).keys()].map(i => ({ id: i, group: i % 2, val: msb(i) })),
        links: [...Array(2*((2**(N+1)-2)-2**N)).keys()]
        .map(id => ({
            source: Math.floor(id/2),
            target: id+2
        }))
    };
    start = gData.nodes.length;
    gData.nodes.push({id:start, group: 2, val:msb(start)});
    gData.links.push({source: start, target: 0});
    gData.links.push({source: start, target: 1});
    window.Graph = ForceGraph3D()
    .backgroundColor("black")
    //.dagMode('td')
    //.dagLevelDistance(200)
    (document.getElementById('banner-graph'))
	.nodeAutoColorBy('group')
    .linkAutoColorBy(d => gData.nodes[d.source].group)
	.onNodeDragEnd(node => {
        node.fx = node.x;
        node.fy = node.y;
        node.fz = node.z;
    })
    .linkDirectionalArrowLength(3.5)
    .linkDirectionalArrowRelPos(1)
    .graphData(gData);
    // camera orbit
    let angle = 0;
    //let isRotationActive = true;
    window.Graph.cameraPosition({
        x: distance * Math.sin(angle),
        z: distance * Math.cos(angle)
    });
    window.Graph.dagGraphModes = ['td', 'bu', 'lr', 'rl', 'zin', 'zout', 'radialout', 'radialin', 'off'];
    window.Graph.currentDagMode = 0;
}
// disabling form submissions if there are invalid fields
(function() {
    'use strict';
    window.addEventListener('load', function() {
      // Fetch all the forms we want to apply custom Bootstrap validation styles to
      var forms = document.getElementsByClassName('needs-validation');
      // Loop over them and prevent submission
      var validation = Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
          if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    }, false);
  })();
</script>

</body>
</html>


